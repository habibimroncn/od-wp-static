import{r as t,c as i,h as s,g as e}from"./p-811c9fd4.js";import{c as h,a,f as n,d as r,l as o,h as l}from"./p-f021dfd0.js";import{c as d}from"./p-bd0aac21.js";import{f as c}from"./p-f3727652.js";import{M as u,V as p}from"./p-8904db17.js";import{e as v,f as y,g as P,h as m,i as g}from"./p-8ffe7be8.js";import{a as f,w as b,c as k}from"./p-5d182d13.js";import{a as w,v as C,h as T}from"./p-b0ea4d0d.js";import{D as S}from"./p-874fa941.js";import{L as j}from"./p-e056694f.js";const A=class{constructor(s){t(this,s),this.vLoadStart=i(this,"vLoadStart",7),this.vMediaElChange=i(this,"vMediaElChange",7),this.vSrcSetChange=i(this,"vSrcSetChange",7),this.disposal=new S,this.wasPausedBeforeSeeking=!0,this.currentSrcSet=[],this.mediaQueryDisposal=new S,this.willAttach=!1,this.preload="metadata",this.playbackRates=[.25,.5,.75,1,1.25,1.5,2],this.language="en",this.autoplay=!1,this.controls=!1,this.loop=!1,this.muted=!1,this.playsinline=!1,this.noConnect=!1,this.paused=!0,this.currentTime=0,this.playbackStarted=!1,this.noConnect||f(this),b(this,["playbackStarted","currentTime","paused"])}onMediaTitleChange(){this.dispatch("mediaTitle",this.mediaTitle)}onPosterChange(){this.dispatch("currentPoster",this.poster)}onViewTypeChange(){this.dispatch("viewType",this.viewType)}connectedCallback(){this.initLazyLoader(),this.dispatch=k(this),this.onViewTypeChange(),this.onPosterChange(),this.onMediaTitleChange(),this.listenToTextTracksChanges()}componentDidRender(){this.prevMediaEl!==this.mediaEl&&(this.prevMediaEl=this.mediaEl,this.vMediaElChange.emit(this.mediaEl))}componentDidLoad(){this.onViewTypeChange()}disconnectedCallback(){var t;this.mediaQueryDisposal.empty(),this.cancelTimeUpdates(),this.disposal.empty(),null===(t=this.lazyLoader)||void 0===t||t.destroy(),this.wasPausedBeforeSeeking=!0}initLazyLoader(){this.lazyLoader=new j(this.el,["data-src","data-poster"],(()=>{if(h(this.mediaEl))return;const t=this.mediaEl.getAttribute("data-poster");a(t)||this.mediaEl.setAttribute("poster",t),this.refresh(),this.didSrcSetChange()}))}refresh(){if(h(this.mediaEl))return;const{children:t}=this.mediaEl;for(let i=0;i<=t.length-1;i+=1){const s=t[i],e=s.getAttribute("data-src")||s.getAttribute("src")||s.getAttribute("data-vs");if(s.removeAttribute("src"),!a(e)){if(s.setAttribute("data-vs",e),!a(s.getAttribute("data-quality"))&&s.getAttribute("data-quality")!==this.playbackQuality){s.removeAttribute("src");continue}s.setAttribute("src",e)}}}didSrcSetChange(){if(h(this.mediaEl))return;const t=Array.from(this.mediaEl.querySelectorAll("source")).map((t=>{var i,s;return{src:t.getAttribute("data-vs"),quality:null!==(i=t.getAttribute("data-quality"))&&void 0!==i?i:void 0,media:null!==(s=t.getAttribute("data-media"))&&void 0!==s?s:void 0,ref:t}}));(this.currentSrcSet.length!==t.length||t.some(((t,i)=>this.currentSrcSet[i].src!==t.src||this.currentSrcSet[i].quality!==t.quality)))&&(this.currentSrcSet=t,this.onSrcSetChange())}onSrcSetChange(){var t;this.mediaQueryDisposal.empty(),this.vLoadStart.emit(),this.vSrcSetChange.emit(this.currentSrcSet),this.hasPlaybackQualities()&&(this.dispatch("playbackQualities",this.getPlaybackQualities()),this.pickInitialPlaybackQuality(),this.refresh()),null===(t=this.mediaEl)||void 0===t||t.load()}hasPlaybackQualities(){return this.currentSrcSet.every((t=>!!t.quality))}getPlaybackQualities(){return this.hasPlaybackQualities()?this.currentSrcSet.map((t=>t.quality)):[]}pickInitialPlaybackQuality(){if(!n(this.playbackQuality))return;const t=t=>{var i,s;return Number(null!==(s=null===(i=t.quality)||void 0===i?void 0:i.slice(0,-1))&&void 0!==s?s:0)},i=(i,s)=>t(i)-t(s);let s=this.currentSrcSet.filter((t=>{if(!r(t.media))return!1;const i=window.matchMedia(t.media),s=d(this);return this.mediaQueryDisposal.add(o(i,"change",(i=>{i.matches&&s("playbackQuality",t.quality)}))),i.matches})).sort(i).pop();n(s)&&(s=this.currentSrcSet.find((i=>t(i)>window.innerWidth))),n(s)&&(s=this.currentSrcSet.sort(i).pop()),this.playbackQuality=null==s?void 0:s.quality,this.dispatch("playbackQuality",null==s?void 0:s.quality)}hasCustomPoster(){const t=c(this);return!v&&!a(t.querySelector("vime-ui vime-poster"))}cancelTimeUpdates(){l(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF),this.timeRAF=void 0}requestTimeUpdates(){var t,i;this.dispatch("currentTime",null!==(i=null===(t=this.mediaEl)||void 0===t?void 0:t.currentTime)&&void 0!==i?i:0),this.timeRAF=window.requestAnimationFrame((()=>{this.requestTimeUpdates()}))}getMediaType(){const{currentSrc:t}=this.mediaEl;return w.test(t)?u.Audio:C.test(t)||T.test(t)?u.Video:void 0}onLoadedMetadata(){this.onTracksChange(),this.playbackStarted?(this.mediaEl.muted=this.muted,this.currentTime>0&&(this.mediaEl.currentTime=this.currentTime),this.paused||this.mediaEl.play()):(this.onProgress(),this.dispatch("currentPoster",this.poster),this.dispatch("duration",this.mediaEl.duration),this.dispatch("playbackRates",this.playbackRates)),this.willAttach||(this.dispatch("currentSrc",this.mediaEl.currentSrc),this.dispatch("mediaType",this.getMediaType()),this.dispatch("playbackReady",!0),this.autoplay&&this.mediaEl.play())}onProgress(){const{buffered:t,duration:i}=this.mediaEl,s=0===t.length?0:t.end(t.length-1);this.dispatch("buffered",s>i?i:s)}onPlay(){this.requestTimeUpdates(),this.dispatch("paused",!1),this.playbackStarted||this.dispatch("playbackStarted",!0)}onPause(){this.cancelTimeUpdates(),this.dispatch("paused",!0),this.dispatch("buffering",!1)}onPlaying(){this.dispatch("playing",!0),this.dispatch("buffering",!1)}onSeeking(){this.wasPausedBeforeSeeking||(this.wasPausedBeforeSeeking=this.mediaEl.paused),this.dispatch("currentTime",this.mediaEl.currentTime),this.dispatch("seeking",!0)}onSeeked(){this.dispatch("seeking",!1),this.playbackStarted&&this.wasPausedBeforeSeeking||this.attemptToPlay(),this.wasPausedBeforeSeeking=!0}onRateChange(){this.dispatch("playbackRate",this.mediaEl.playbackRate)}onVolumeChange(){this.dispatch("muted",this.mediaEl.muted),this.dispatch("volume",100*this.mediaEl.volume)}onDurationChange(){this.dispatch("duration",this.mediaEl.duration)}onWaiting(){this.dispatch("buffering",!0)}onSuspend(){this.dispatch("buffering",!1)}onEnded(){this.loop||this.dispatch("playbackEnded",!0)}onError(){this.dispatch("errors",[this.mediaEl.error])}attemptToPlay(){var t;try{null===(t=this.mediaEl)||void 0===t||t.play()}catch(t){this.dispatch("errors",[t])}}togglePiPInChrome(t){var i;return t?null===(i=this.mediaEl)||void 0===i?void 0:i.requestPictureInPicture():document.exitPictureInPicture()}togglePiPInSafari(t){var i,s;const e=t?"picture-in-picture":"inline";if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsPresentationMode(e)))throw new Error("PiP API is not available.");return null===(s=this.mediaEl)||void 0===s?void 0:s.webkitSetPresentationMode(e)}async togglePiP(t){if(y())return this.togglePiPInChrome(t);if(P())return this.togglePiPInSafari(t);throw new Error("PiP API is not available.")}async toggleFullscreen(t){var i,s,e;if(!(null===(i=this.mediaEl)||void 0===i?void 0:i.webkitSupportsFullscreen))throw new Error("Fullscreen API is not available.");return t?null===(s=this.mediaEl)||void 0===s?void 0:s.webkitEnterFullscreen():null===(e=this.mediaEl)||void 0===e?void 0:e.webkitExitFullscreen()}onPresentationModeChange(){var t;const i=null===(t=this.mediaEl)||void 0===t?void 0:t.webkitPresentationMode;this.dispatch("isPiPActive","picture-in-picture"===i),this.dispatch("isFullscreenActive","fullscreen"===i)}onEnterPiP(){this.dispatch("isPiPActive",!0)}onLeavePiP(){this.dispatch("isPiPActive",!1)}onTracksChange(){this.dispatch("textTracks",this.mediaEl.textTracks)}listenToTextTracksChanges(){n(this.mediaEl)||this.disposal.add(o(this.mediaEl.textTracks,"change",this.onTracksChange.bind(this)))}async getAdapter(){return{getInternalPlayer:async()=>this.mediaEl,play:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.play()},pause:async()=>{var t;return null===(t=this.mediaEl)||void 0===t?void 0:t.pause()},canPlay:async t=>r(t)&&(w.test(t)||C.test(t)),setCurrentTime:async t=>{this.mediaEl&&(this.mediaEl.currentTime=t)},setMuted:async t=>{this.mediaEl&&(this.mediaEl.muted=t)},setVolume:async t=>{this.mediaEl&&(this.mediaEl.volume=t/100)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.mediaEl&&(this.mediaEl.playbackRate=t)},canSetPlaybackQuality:async()=>this.hasPlaybackQualities(),setPlaybackQuality:async t=>{var i;this.cancelTimeUpdates(),this.playbackQuality=t,this.refresh(),null===(i=this.mediaEl)||void 0===i||i.load(),this.dispatch("playbackQuality",this.playbackQuality)},canSetPiP:async()=>m(),enterPiP:()=>this.togglePiP(!0),exitPiP:()=>this.togglePiP(!1),canSetFullscreen:async()=>g(),enterFullscreen:()=>this.toggleFullscreen(!0),exitFullscreen:()=>this.toggleFullscreen(!1)}}render(){const t={autoplay:this.autoplay,muted:this.muted,playsinline:this.playsinline,playsInline:this.playsinline,"x5-playsinline":this.playsinline,"webkit-playsinline":this.playsinline,controls:this.controls,crossorigin:this.crossOrigin,controlslist:this.controlsList,"data-poster":this.hasCustomPoster()?void 0:this.poster,loop:this.loop,preload:this.preload,disablePictureInPicture:this.disablePiP,autoPictureInPicture:this.autoPiP,disableRemotePlayback:this.disableRemotePlayback,"x-webkit-airplay":this.disableRemotePlayback?"deny":"allow",ref:t=>{this.mediaEl=t},onLoadedMetadata:this.onLoadedMetadata.bind(this),onProgress:this.onProgress.bind(this),onPlay:this.onPlay.bind(this),onPause:this.onPause.bind(this),onPlaying:this.onPlaying.bind(this),onSeeking:this.onSeeking.bind(this),onSeeked:this.onSeeked.bind(this),onRateChange:this.onRateChange.bind(this),onVolumeChange:this.onVolumeChange.bind(this),onDurationChange:this.onDurationChange.bind(this),onWaiting:this.onWaiting.bind(this),onSuspend:this.onSuspend.bind(this),onEnded:this.onEnded.bind(this),onError:this.onError.bind(this)},i=s("audio",Object.assign({class:"lazy"},t),s("slot",null),"Your browser does not support the",s("code",null,"audio"),"element."),e=s("video",Object.assign({class:"lazy"},t,{onwebkitpresentationmodechanged:this.onPresentationModeChange.bind(this),onenterpictureinpicture:this.onEnterPiP.bind(this),onleavepictureinpicture:this.onLeavePiP.bind(this)}),s("slot",null),"Your browser does not support the",s("code",null,"video"),"element.");return this.viewType===p.Audio?i:e}get el(){return e(this)}static get watchers(){return{mediaTitle:["onMediaTitleChange"],poster:["onPosterChange"],viewType:["onViewTypeChange"]}}};A.style="vime-file audio,vime-file video{border-radius:inherit;vertical-align:middle;width:100%;outline:0}vime-file video{position:absolute;top:0;left:0;border:0;height:100%;user-select:none}";const E=class{constructor(i){t(this,i),this.willAttach=!1,this.preload="metadata",this.willAttach||f(this)}async getAdapter(){return this.fileProvider.getAdapter()}render(){return s("vime-file",{noConnect:!0,willAttach:this.willAttach,crossOrigin:this.crossOrigin,poster:this.poster,preload:this.preload,controlsList:this.controlsList,autoPiP:this.autoPiP,disablePiP:this.disablePiP,disableRemotePlayback:this.disableRemotePlayback,mediaTitle:this.mediaTitle,viewType:p.Video,ref:t=>{this.fileProvider=t}},s("slot",null))}};export{A as vime_file,E as vime_video}